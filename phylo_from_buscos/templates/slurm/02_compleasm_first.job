#!/bin/bash
#SBATCH --job-name=compleasm_first
#SBATCH --cpus-per-task=TOTAL_THREADS  # Replace with total available CPUs (e.g., 64)
#SBATCH --mem-per-cpu=6G
#SBATCH --time=24:00:00
#SBATCH --output=logs/compleasm_first.%j.out
#SBATCH --error=logs/compleasm_first.%j.err

source ~/.bashrc
conda activate phylo

mkdir -p logs

# Process FIRST genome only (downloads lineage database)
first_genome=$(head -n 1 genome_list.txt)
genome_name=$(basename ${first_genome} .fasta)
echo "Processing first genome: ${genome_name} with ${SLURM_CPUS_PER_TASK} threads..."
echo "This will download the BUSCO lineage database for subsequent runs."

compleasm run \
  -a ${first_genome} \
  -o ${genome_name}_compleasm \
  -l LINEAGE \
  -t ${SLURM_CPUS_PER_TASK}

echo "First genome complete! Lineage database is now cached."
echo "Submit the parallel job for remaining genomes: sbatch run_compleasm_parallel.job"
