#!/bin/bash
#SBATCH --job-name=compleasm_parallel
#SBATCH --array=2-NUM_GENOMES  # Start from genome 2 (first genome already processed)
#SBATCH --cpus-per-task=THREADS_PER_JOB  # e.g., 16 for 64-core system with 4 concurrent jobs
#SBATCH --mem-per-cpu=6G
#SBATCH --time=48:00:00
#SBATCH --output=logs/compleasm.%A_%a.out
#SBATCH --error=logs/compleasm.%A_%a.err

source ~/.bashrc
conda activate phylo

mkdir -p 01_busco_results

# Get genome for this array task (skipping the first one)
genome=$(sed -n "${SLURM_ARRAY_TASK_ID}p" genome_list.txt)
genome_name=$(basename ${genome} .fasta)

echo "Processing ${genome_name} with ${SLURM_CPUS_PER_TASK} threads..."

compleasm run \
  -a ${genome} \
  -o 01_busco_results/${genome_name}_compleasm \
  -l LINEAGE \
  -t ${SLURM_CPUS_PER_TASK}
