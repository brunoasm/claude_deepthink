#!/bin/bash
#PBS -N compleasm_first
#PBS -l nodes=1:ppn=TOTAL_THREADS  # Replace with total available CPUs (e.g., 64)
#PBS -l mem=384gb  # Adjust based on ppn Ã— 6GB
#PBS -l walltime=24:00:00

cd $PBS_O_WORKDIR
source ~/.bashrc
conda activate phylo

mkdir -p logs

# Process FIRST genome only (downloads lineage database)
first_genome=$(head -n 1 genome_list.txt)
genome_name=$(basename ${first_genome} .fasta)
echo "Processing first genome: ${genome_name} with $PBS_NUM_PPN threads..."
echo "This will download the BUSCO lineage database for subsequent runs."

compleasm run \
  -a ${first_genome} \
  -o ${genome_name}_compleasm \
  -l LINEAGE \
  -t $PBS_NUM_PPN

echo "First genome complete! Lineage database is now cached."
echo "Submit the parallel job for remaining genomes: qsub run_compleasm_parallel.job"
