#!/bin/bash
#PBS -N compleasm_parallel
#PBS -t 2-NUM_GENOMES  # Start from genome 2 (first genome already processed)
#PBS -l nodes=1:ppn=THREADS_PER_JOB  # e.g., 16 for 64-core system
#PBS -l mem=96gb  # Adjust based on ppn Ã— 6GB
#PBS -l walltime=48:00:00

cd $PBS_O_WORKDIR
source ~/.bashrc
conda activate phylo

# Get genome for this array task
genome=$(sed -n "${PBS_ARRAYID}p" genome_list.txt)
genome_name=$(basename ${genome} .fasta)

echo "Processing ${genome_name} with $PBS_NUM_PPN threads..."

compleasm run \
  -a ${genome} \
  -o ${genome_name}_compleasm \
  -l LINEAGE \
  -t $PBS_NUM_PPN
